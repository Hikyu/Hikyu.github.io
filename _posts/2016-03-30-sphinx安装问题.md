---
layout: post
categories: python 编码
---

>领导给安排的任务是修改数据库的帮助手册。从仓库下载了代码以后就一直在倒腾环境的安装。生成文档的工具是Python
 环境下的Sphinx。就是这个Sphinx,昨天倒腾了一天都没装上，郁闷。

>一开始安装Python3，到是一路顺畅，没有什么问题。但是在使用Sphinx的时候就报错了。原因是之前文档的创建环境是
 Python2，Python3与Python2是不兼容的，在编码问题上报错。

>遂改之，卸载Python3，安装Python2.问题来了。

安装完Python2之后，使用 easy_install sphinx 
指令来安装sphinx。可是死活装不上，换源和使用pip都不行，苦逼。报这样一个错误：

UnicodeEncodeError: 'ascii' codec can't encode characters in position 4-5: ordi al not in range(128)

意思就是Python执行环境的默认编码是ascii码，Python调用ascii编码解码程序去处理字符流，当字符流不属于ascii范围内
，就会抛出异常（ordinal not in range(128)）。

看了一下报错的位置，都是在安装sphinx之前安装的所需的依赖出了问题，都是一堆
.py文件。某些函数读取字符流的时候出了问题。这可咋整。。。我也没法知道他读的流是啥啊。

后来想到了一个解决办法，那就是修改Python编码环境为UTF-8，问题可能就迎刃而解了。

首先所有修改的动作都是要创建一个叫 **sitecustomize.py**的文件，为什么要创建这个文件呢，是因为python在启动的时候会
去load的这个文件，所以你如果要修改一些启动的变量就可以把操作写在这个文件。

修改默认字符编码的代码很简单就2行：

```

# sitecustomize.py                   # this file can be anywhere in your Python path,
# but it usually goes in ${pythondir}/lib/site-packages/
import sys
sys.setdefaultencoding('utf-8') 

```

写完这个文件放哪里呢？

windows :存放在你python的安装的目录Lib\site-packages(比如C:\Python27\Lib\site-packages)里。 

ok,现在再次运行 easy_install sphinx ，可以通过安装了！

ps:Python3 已经解决了这个问题，所以在Python3 环境下不会出现这个错误。

**参考**

[解决Python2.7的UnicodeEncodeError: ‘ascii’ codec can’t encode异常错误](http://wangye.org/blog/archives/629/)

[永久修改python默认的字符编码为utf-8](http://blog.sina.com.cn/s/blog_494e45fe0102e3p9.html)       
