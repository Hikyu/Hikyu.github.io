<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="加密," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="这两天打算在组内做个培训，关于Https方面的。于是一直在查资料，理解，顺便把今天了解的内容总结一下。
之前已经写过两篇有关ssl方面的笔记：关于加密的一点总结，ssl总结。当时的理解现在看来还有一些欠缺的地方，温故而知新嘛！

数字签名
数字签名是一种类似写在纸上的普通的物理签名，但是使用了公钥加密领域的技术实现，用于鉴别数字信息的方法。(很空洞有木有~)

数字签名的作用：身份认证与完整性检">
<meta property="og:type" content="article">
<meta property="og:title" content="springboot配置https">
<meta property="og:url" content="http://yukai.space/2017/07/12/springboot配置https/index.html">
<meta property="og:site_name" content="YuKai's blog">
<meta property="og:description" content="这两天打算在组内做个培训，关于Https方面的。于是一直在查资料，理解，顺便把今天了解的内容总结一下。
之前已经写过两篇有关ssl方面的笔记：关于加密的一点总结，ssl总结。当时的理解现在看来还有一些欠缺的地方，温故而知新嘛！

数字签名
数字签名是一种类似写在纸上的普通的物理签名，但是使用了公钥加密领域的技术实现，用于鉴别数字信息的方法。(很空洞有木有~)

数字签名的作用：身份认证与完整性检">
<meta property="og:image" content="http://yukai.space/2017/07/12/springboot配置https/1.png">
<meta property="og:image" content="http://yukai.space/2017/07/12/springboot配置https/2.png">
<meta property="og:image" content="http://yukai.space/2017/07/12/springboot配置https/1.png">
<meta property="og:image" content="http://yukai.space/2017/07/12/springboot配置https/4.png">
<meta property="og:image" content="http://yukai.space/2017/07/12/springboot配置https/https.png">
<meta property="og:image" content="http://yukai.space/2017/07/12/springboot配置https/tls.png">
<meta property="og:image" content="http://yukai.space/2017/07/12/springboot配置https/zhengshu.png">
<meta property="og:image" content="http://yukai.space/2017/07/12/springboot配置https/zhengshulian.jpg">
<meta property="og:image" content="http://yukai.space/2017/07/12/springboot配置https/res.png">
<meta property="og:updated_time" content="2017-11-02T01:44:09.733Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="springboot配置https">
<meta name="twitter:description" content="这两天打算在组内做个培训，关于Https方面的。于是一直在查资料，理解，顺便把今天了解的内容总结一下。
之前已经写过两篇有关ssl方面的笔记：关于加密的一点总结，ssl总结。当时的理解现在看来还有一些欠缺的地方，温故而知新嘛！

数字签名
数字签名是一种类似写在纸上的普通的物理签名，但是使用了公钥加密领域的技术实现，用于鉴别数字信息的方法。(很空洞有木有~)

数字签名的作用：身份认证与完整性检">
<meta name="twitter:image" content="http://yukai.space/2017/07/12/springboot配置https/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yukai.space/2017/07/12/springboot配置https/"/>





  <title> springboot配置https | YuKai's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">YuKai's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">好好学习，天天向上</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            主页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tools">
          <a href="/tools" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            工具
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/page" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yukai.space/2017/07/12/springboot配置https/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="于凯">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YuKai's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                springboot配置https
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-12T22:19:17+08:00">
                2017-07-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>这两天打算在组内做个培训，关于Https方面的。于是一直在查资料，理解，顺便把今天了解的内容总结一下。</p>
<p>之前已经写过两篇有关ssl方面的笔记：<a href="http://yukai.space/2016/08/22/%E5%85%B3%E4%BA%8E%E5%8A%A0%E5%AF%86%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/">关于加密的一点总结</a>，<a href="http://yukai.space/2016/09/25/ssl%E6%80%BB%E7%BB%93/">ssl总结</a>。当时的理解现在看来还有一些欠缺的地方，温故而知新嘛！</p>
</blockquote>
<h2 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h2><blockquote>
<p>数字签名是一种类似写在纸上的普通的物理签名，但是使用了公钥加密领域的技术实现，用于鉴别数字信息的方法。(很空洞有木有~)</p>
</blockquote>
<p>数字签名的作用：<strong>身份认证与完整性检验</strong></p>
<p>下面模拟一个场景，小明给小红写一封信。</p>
<ol>
<li><p>首先将摘要信息用发送者小明的私钥加密，生成数字签名，与原始信息一起传送给接收者小红。(什么是摘要信息，公钥私钥在前面的笔记中提到了，不再赘述)</p>
</li>
<li><p>小红使用小明的公钥对小明私钥加密后的摘要信息进行解密，如果解密成功，则说明接收到的内容确实由小明发出。这就完成了发送者小明的身份认证。</p>
</li>
<li><p>小红对收到的原始信息使用信息摘要算法得到其哈希值，与2中解密后的摘要信息进行比较，如果一致，证明原始信息未经篡改。保证了信息完整性（完整性检验）。</p>
</li>
</ol>
<img src="/2017/07/12/springboot配置https/1.png" alt="小明写信" title="小明写信">
<img src="/2017/07/12/springboot配置https/2.png" alt="小红写信" title="小红写信">
<a id="more"></a>
<p>上面的过程有一个明显的疑问，就是小红是如何得到小明提供的公钥呢？</p>
<ul>
<li><p>把公钥放到互联网的某个地方的一个下载地址，事先给客户去下载？</p>
</li>
<li><p>每次和客户开始通信时，服务器把公钥发给客户？</p>
</li>
</ul>
<p>客户无法确定这个下载地址是不是服务器发布的，你凭什么就相信这个地址下载的东西就是服务器发布的而不是别人伪造的呢，万一下载到一个假的怎么办？另外要所有的客户都在通信前事先去下载公钥也很不现实。</p>
<p>任何人都可以自己生成一对公钥和私钥，他只要向客户发送他自己的私钥就可以冒充服务器了。</p>
<p>所以。数字证书出现了。</p>
<h2 id="数字证书"><a href="#数字证书" class="headerlink" title="数字证书"></a>数字证书</h2><blockquote>
<p>数字证书是一种权威性的电子文档，可以由权威公正的第三方机构，即CA（例如中国各地方的CA公司）中心签发的证书，也可以由企业级CA系统进行签发。</p>
</blockquote>
<p>小红无法确定自己获得的公钥是不是小明的，她想到了一个办法：</p>
<p>要求小明去找“证书中心”（certificate authority，简称CA），为公钥做认证。证书中心用自己的私钥，对小明的公钥和一些相关信息一起加密，生成”数字证书”（Digital Certificate）。</p>
<p>小明以后再给小红写信，只要在签名的同时，再附上数字证书就行了。</p>
<p>小红收信后，用CA的公钥解开数字证书，就可以拿到小明真实的公钥了，然后就能证明“数字签名”是否真的是小明签的。</p>
<img src="/2017/07/12/springboot配置https/1.png" alt="小明写信" title="小明写信">
<img src="/2017/07/12/springboot配置https/4.png" alt="小红写信" title="小红写信">
<h2 id="Https演化"><a href="#Https演化" class="headerlink" title="Https演化"></a>Https演化</h2><p>上面小明给小红写信的过程类似于https的工作原理。首先我们知道，所谓https是在http协议的基础上加了一层ssl/tls协议：</p>
<img src="/2017/07/12/springboot配置https/https.png" alt="https" title="https">
<p>ssl/tls能起到什么作用呢？</p>
<ul>
<li><p>所有信息都是加密传播，第三方无法窃听（窃听风险）</p>
</li>
<li><p>具有校验机制，一旦被篡改，通信双方会立刻发现（篡改风险）</p>
</li>
<li><p>配备身份证书，防止身份被冒充（冒充风险）</p>
</li>
</ul>
<p>如何做到以上几点，参考之前的<a href="http://yukai.space/2016/08/22/%E5%85%B3%E4%BA%8E%E5%8A%A0%E5%AF%86%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/">笔记</a>中关于通信演化过程的内容。</p>
<p>https通信的过程如下图：</p>
<img src="/2017/07/12/springboot配置https/tls.png" alt="https" title="https">
<p>握手阶段服务器发送了自己的证书，确认了服务器的身份并且双方商议好了对称加密的算法好密钥，应用数据传输阶段就使用对称加密算法加密信息进行通信了。</p>
<h2 id="证书链"><a href="#证书链" class="headerlink" title="证书链"></a>证书链</h2><p>在握手阶段，服务器会把自己的证书发送到客户端(以浏览器为例)，那么客户端是怎么使用这个证书确认服务器的身份的呢？</p>
<p>首先观察一下证书里有什么内容：</p>
<img src="/2017/07/12/springboot配置https/zhengshu.png" alt="数字证书" title="数字证书">
<p>上图只截取了一部分，我们看几个比较重要的：</p>
<ul>
<li>Issuer (证书的发布机构)</li>
</ul>
<p>指出是什么机构发布的这个证书，也就是指明这个证书是哪个公司创建的(只是创建证书，不是指证书的使用者)。</p>
<ul>
<li>Valid from , Valid to (证书的有效期)</li>
</ul>
<p>也就是证书的有效时间，或者说证书的使用期限。 过了有效期限，证书就会作废，不能使用了。</p>
<ul>
<li>Public key (公钥)</li>
</ul>
<p>公钥是用来对消息进行加密的，也就是服务器使用的公钥。</p>
<ul>
<li>Subject (使用者)</li>
</ul>
<p>这个证书是发布给谁的，或者说证书的所有者，一般是某个人或者某个公司名称、机构的名称、公司网站的网址等。 </p>
<ul>
<li>Thumbprint, Thumbprint algorithm (指纹以及指纹算法)</li>
</ul>
<p>这个是用来保证证书的完整性的，也就是说确保证书没有被修改过。 其原理就是在发布证书时，发布者根据指纹算法(一个hash算法)计算整个证书的hash值(指纹)并和证书放在一起，使用者在打开证书时，自己也根据指纹算法计算一下证书的hash值(指纹)，如果和刚开始的值对得上，就说明证书没有被修改过，因为证书的内容被修改后，根据证书的内容计算的出的hash值(指纹)是会变化的。</p>
<ul>
<li>Signature algorithm (签名所使用的算法)</li>
</ul>
<p>指纹的加密结果就是数字签名。 注意，这个指纹会使用证书发布机构的私钥用签名算法(Signature algorithm)加密后生成数字签名和证书放在一起。</p>
<p>Signature algorithm就是指的这个数字证书的数字签名所使用的加密算法，这样就可以使用证书发布机构的证书里面的公钥，根据这个算法对指纹进行解密。</p>
<p>什么是证书链呢？</p>
<img src="/2017/07/12/springboot配置https/zhengshulian.jpg" alt="证书链" title="证书链">
<p>上图中的Issuer’s DN即证书颁发机构，这样的证书颁发机构可能不止一个，上图表示一个3级证书链。</p>
<p>Owner’s DN 代表服务器发来的证书，浏览器得到这个证书之后根据Issuer’s DN获得该证书的颁发机构的证书，以此类推，最终得到根证书。比如 A-&gt;B-&gt;C-&gt;root</p>
<p>什么是根证书呢？一般是内嵌在操作系统中的，公认的可以信任的证书机构颁发的自签名证书。这些证书发布机构自己持有与他自己的数字证书对应的私钥，他会用这个私钥加密所有他发布的证书的指纹作为数字签名。浏览器无条件的信任根证书。</p>
<p>得到根证书后，拿到其公钥，然后使用这个公钥对证书链的上一级证书c依据Signature algorithm对指纹的加密结果(签名)进行解密，得到证书c的指纹。解密成功，证明c确实是由root颁发的，然后使用Thumbprint algorithm计算一下证书c的指纹，如果和解密得到的指纹相同，证明证书没有被篡改。因此，证书c是可以信任的。以此类推，证明证书A是可以信任的。也就是服务器发来的证书是可以信任的。</p>
<p>问题一：服务器可不可以随便下载一个认证的证书自己使用呢？</p>
<p>证书中包含了服务器端的公钥，浏览器会使用该公钥加密一个随机字符串要求服务器解密。服务器没有该证书的私钥，故解密失败</p>
<p>问题二：可不可以篡改一个已经认证的服务器为我所用？</p>
<p>证书中包含了证书的指纹，证书一经篡改就会被察觉</p>
<p>可以看到，https已经是很安全了。但是要注意，一旦信任根证书，则意味着信任了该证书所签发的所有下级证书，所以，安装根证书一定要谨慎！</p>
<h2 id="使用keytool生成证书"><a href="#使用keytool生成证书" class="headerlink" title="使用keytool生成证书"></a>使用keytool生成证书</h2><p>使用下面的方法生成一个二级证书链：</p>
<ul>
<li><p>生成根证书密钥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">keytool -genkey -alias CA -keyalg RSA -validity 365 -keystore server.keystore -storepass 123456 -keypass 123456 </div><div class="line">keytool -list -v -keystore server.keystore</div></pre></td></tr></table></figure>
</li>
<li><p>生成自签名证书密钥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">keytool -genkey -keystore server.keystore  -alias server -keyalg RSA -validity 365 -storepass 123456 -keypass 123456 </div><div class="line">keytool -list -keystore server.keystore -alias server</div></pre></td></tr></table></figure>
</li>
<li><p>提交申请</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">keytool -certreq -keystore server.keystore -alias server -storepass 123456 -file server.certreq </div><div class="line">keytool -printcertreq -file server.certreq -v</div></pre></td></tr></table></figure>
</li>
<li><p>颁发证书</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 新升级的chrome58，要求证书中至少包含一个[Subject Alternative Name](https://support.dnsimple.com/articles/what-is-ssl-san/)</div><div class="line">keytool -gencert -keystore server.keystore -alias CA -ext san=ip:192.168.1.70 -infile server.certreq -outfile server.crt -storepass 123456</div></pre></td></tr></table></figure>
</li>
<li><p>自签名证书导入keystore</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">keytool -importcert -keystore server.keystore -alias server -file server.crt -storepass 123456</div><div class="line">keytool -list -keystore server.keystore -v -alias server</div></pre></td></tr></table></figure>
</li>
<li><p>导出根证书</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">keytool -export -alias CA -keystore server.keystore -file CA.crt -storepass 123456</div></pre></td></tr></table></figure>
</li>
</ul>
<p>目录下得到以下几个文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">CA.crt //根证书</div><div class="line">server.certreq // server证书申请</div><div class="line">server.crt // server证书</div><div class="line">server.keystore //密钥库</div></pre></td></tr></table></figure>
<h2 id="Chrome导入根证书"><a href="#Chrome导入根证书" class="headerlink" title="Chrome导入根证书"></a>Chrome导入根证书</h2><p>设置-&gt;高级-&gt;管理证书-&gt;受信任的根证书颁发机构-&gt;导入</p>
<h2 id="springboot配置https"><a href="#springboot配置https" class="headerlink" title="springboot配置https"></a>springboot配置https</h2><p>在application.properties中增加以下配置：(跟上一步对应)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">server.ssl.key-store=server.keystore</div><div class="line"></div><div class="line">server.ssl.key-store-password=123456</div><div class="line"></div><div class="line">server.ssl.keyStoreType=JKS</div><div class="line"></div><div class="line">server.ssl.keyAlias:server</div></pre></td></tr></table></figure>
<h3 id="开启http"><a href="#开启http" class="headerlink" title="开启http"></a>开启http</h3><p>配置好https后发现http方式无法访问，服务器强制使用https方式，可以在 @Configuration注解的类中增加下面的配置同时开启http</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="function"><span class="keyword">public</span> EmbeddedServletContainerFactory <span class="title">servletContainer</span><span class="params">()</span> </span>&#123;</div><div class="line">    TomcatEmbeddedServletContainerFactory tomcat = <span class="keyword">new</span> TomcatEmbeddedServletContainerFactory() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">postProcessContext</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">          SecurityConstraint securityConstraint = <span class="keyword">new</span> SecurityConstraint();</div><div class="line">          securityConstraint.setUserConstraint(<span class="string">"CONFIDENTIAL"</span>);</div><div class="line">          SecurityCollection collection = <span class="keyword">new</span> SecurityCollection();</div><div class="line">          collection.addPattern(<span class="string">"/*"</span>);</div><div class="line">          securityConstraint.addCollection(collection);</div><div class="line">          context.addConstraint(securityConstraint);</div><div class="line">        &#125;</div><div class="line">      &#125;;</div><div class="line">    </div><div class="line">    tomcat.addAdditionalTomcatConnectors(initiateHttpConnector());</div><div class="line">    <span class="keyword">return</span> tomcat;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">private</span> Connector <span class="title">initiateHttpConnector</span><span class="params">()</span> </span>&#123;</div><div class="line">    Connector connector = <span class="keyword">new</span> Connector(<span class="string">"org.apache.coyote.http11.Http11NioProtocol"</span>);</div><div class="line">    connector.setScheme(<span class="string">"http"</span>);</div><div class="line">    connector.setPort(<span class="number">8080</span>);</div><div class="line">    connector.setSecure(<span class="keyword">false</span>);</div><div class="line">    connector.setRedirectPort(<span class="number">8443</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> connector;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h3 id="http重定向到https"><a href="#http重定向到https" class="headerlink" title="http重定向到https"></a>http重定向到https</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;server.port&#125;"</span>)</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> port;</div><div class="line"></div><div class="line"><span class="meta">@Bean</span></div><div class="line"><span class="function"><span class="keyword">public</span> EmbeddedServletContainerFactory <span class="title">servletContainer</span><span class="params">()</span> </span>&#123;</div><div class="line">		TomcatEmbeddedServletContainerFactory tomcat = <span class="keyword">new</span> TomcatEmbeddedServletContainerFactory() &#123;</div><div class="line">			<span class="meta">@Override</span></div><div class="line">			<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">postProcessContext</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">				SecurityConstraint securityConstraint = <span class="keyword">new</span> SecurityConstraint();</div><div class="line">				securityConstraint.setUserConstraint(<span class="string">"CONFIDENTIAL"</span>);</div><div class="line">				SecurityCollection collection = <span class="keyword">new</span> SecurityCollection();</div><div class="line">				collection.addPattern(<span class="string">"/*"</span>);</div><div class="line">				securityConstraint.addCollection(collection);</div><div class="line">				context.addConstraint(securityConstraint);</div><div class="line">			&#125;</div><div class="line">		&#125;;</div><div class="line">		tomcat.addAdditionalTomcatConnectors(initiateHttpConnector());</div><div class="line">		<span class="keyword">return</span> tomcat;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> Connector <span class="title">initiateHttpConnector</span><span class="params">()</span> </span>&#123;</div><div class="line">		Connector connector = <span class="keyword">new</span> Connector(<span class="string">"org.apache.coyote.http11.Http11NioProtocol"</span>);</div><div class="line">		connector.setScheme(<span class="string">"http"</span>);</div><div class="line">		connector.setPort(getHttpPort());</div><div class="line">		connector.setSecure(<span class="keyword">false</span>);</div><div class="line">		connector.setRedirectPort(port);</div><div class="line">		<span class="keyword">return</span> connector;</div><div class="line">&#125;</div><div class="line">	</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getHttpPort</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">80</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>https配置到此完成，美滋滋：</p>
<img src="/2017/07/12/springboot配置https/res.png" alt="效果" title="效果">

      
    </div>

    <div>
      
        
<div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/images/wechat-qcode.jpg" alt="于凯 wechat" style="width: 200px; max-width: 100%;"/>
    <div>欢迎您扫一扫上面的微信公众号，订阅我的博客！</div>
</div>


      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/加密/" rel="tag"># 加密</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/07/10/Linux网络IO模型/" rel="next" title="Linux网络IO模型">
                <i class="fa fa-chevron-left"></i> Linux网络IO模型
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/08/10/状态机与状态模式/" rel="prev" title="状态机与状态模式">
                状态机与状态模式 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        
<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="于凯" />
          <p class="site-author-name" itemprop="name">于凯</p>
           
              <p class="site-description motion-element" itemprop="description">Learning...</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/">
                <span class="site-state-item-count">83</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">27</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/5381447277" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/Hikyu" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#数字签名"><span class="nav-number">1.</span> <span class="nav-text">数字签名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数字证书"><span class="nav-number">2.</span> <span class="nav-text">数字证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Https演化"><span class="nav-number">3.</span> <span class="nav-text">Https演化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#证书链"><span class="nav-number">4.</span> <span class="nav-text">证书链</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用keytool生成证书"><span class="nav-number">5.</span> <span class="nav-text">使用keytool生成证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chrome导入根证书"><span class="nav-number">6.</span> <span class="nav-text">Chrome导入根证书</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#springboot配置https"><span class="nav-number">7.</span> <span class="nav-text">springboot配置https</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#开启http"><span class="nav-number">7.1.</span> <span class="nav-text">开启http</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#http重定向到https"><span class="nav-number">7.2.</span> <span class="nav-text">http重定向到https</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">于凯</span>
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  

  

  

</body>
</html>
